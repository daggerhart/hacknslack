var _ = require('lodash');

/**
 * Constructor provides default values for properties
 */
var Item = function(){
  this.name = '';
  this.desc = '';
  this.effects = [];
  this.actions = [];
  this.type = '';
};

/**
 * Object factor produces a new object, merges stub information, and does preprocessing
 */
Item.create = function( stub ){
  var item = new Item();

  // merge stub into object
  if ( typeof stub === 'object' ) {
    // reload from file if encounter is a stub
    if ( stub.is_stub && stub.filename ) {
      console.log('-- item reloaded from file');

      var fileStub = tools.files.getItem(stub.filename, stub.index);

      // merge argument stub and fileStub together
      // this let's us re-attach methods from the file
      // this stub was originally loaded from
      _.merge(fileStub, stub);

      // merge the resulting stub to this item
      _.merge(item, fileStub);

      console.log('FINAL MERGED ITEM');console.log(item);
    }
    else {
      console.log('-- encounter constructor with stub');
      _.merge(item, stub);
    }
  }

  return item;
};

module.exports = Item;