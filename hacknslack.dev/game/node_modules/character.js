/**
 *
 * character = {
 *   // (string) - unique character class
 *   class: String,
 *
 *   // (Number) - character level
 *   level: 1,
 *
 *   // (array of strings) - refer to global actions this character can perform
 *   actions: ['status', 'equip'],
 *
 *   // (object) of specific properties, each property's value is an item object
 *   equipment: {
 *     weapon: {item},
 *     armor: {item},
 *     gear: {item}
 *   },
 *
 *   // (object) of specific properties, each property's value is a number
 *   attributes: {
 *     body: Number,
 *     mind: Number,
 *     spirit: Number,
 *     hp: Number
 *   },
 *
 *   // (array) of item objects
 *   items:[
 *     {item},
 *     {item}
 *   ],
 *
 *   // (adventure object) - the character's current adventure
 *   adventure: {},
 *
 *   // (Number) - encounter array index
 *   // current_encounter: 0,
 * }
 */
var _ = require('lodash');
var Buff = require('buff');

var Character = function( stub ){

  this.name = '';
  this.class = {};
  this.level = 0;
  this.xp = 0;
  this.actions = ['status'];
  this.equipment = {
    weapon: {},
    armor: {},
    gear: {}
  };
  this.attributes = {
    body: 0,
    mind: 0,
    spirit: 0,
    hp: 1
  };
  // the buff objects attached to this character
  this.buffs = [];
  // the total value of buffs per attribute
  this.buff_totals = {
    body: 0,
    mind: 0,
    spirit: 0,
    hp: 0
  };

  this.items = [];
  this.adventure = {};
  this.current_encounter = 0;

  // merge stub into object
  if ( typeof stub === 'object' ) {
    _.merge(this, stub );
  }

  /**
   * Get an attribute's base value
   *
   * @param attr
   * @returns {*}
   */
  this.getAttr = function( attr ){
    if ( this.attributes[ attr ] ) {
      return this.attributes[ attr ];
    }

    return 0;
  };

  /**
   * Get the buff value of an attribute
   *
   * @param attr
   * @return int
   */
  this.getAttrBuff = function( attr ){
    if ( this.buff_totals[ attr ] ){
      return this.buff_totals[ attr ];
    }

    return 0;
  };

  /**
   * Get the total value of an attribute and its buffs
   *
   * @param attr
   * @return integer
   */
  this.getAttrTotal = function( attr ) {
    return this.getAttr( attr ) + this.getAttrBuff( attr );
  };

  /**
   * Gather the bonuses/buffs for this character into the this.buffs object
   */
  this.getBuffTotals = function() {
    var buff_totals = this.buff_totals;

    for( var i = 0; i < this.buffs.length; i++ ){
      // this buff object
      var buff = this.buffs[ i ];

      if ( this.attributes[ buff.attribute ] ) {
        // add the buff amount to the totals
        buff_totals[ buff.attribute ] += buff.amount;
      }
    }

    this.buff_totals = buff_totals;
  };

  /**
   * Add a new buff to this character
   */
  this.addBuff = function( stub ){
    var buff = new Buff( stub );
    this.buffs.push( buff );
  };


  // do the math to get buff totals.
  this.getBuffTotals();
};

module.exports = Character;