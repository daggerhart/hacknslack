/**
 * adventure = {
 *
 *   // (array of strings) tags for this adventure. can be used to get specific encounter types
 *   tags: [],
 *
 *   // (array of effects) executed when adventure is complete
 *   completed: [
 *     {effect object},
 *     {effect object}
 *   ],
 *
 *   // (array of encounters)
 *   encounters: [
 *     { encounter object },
 *     { encounter object },
 *     ....
 *   ],
 * }
 */

var _ = require('lodash');
var tools = require('tools');

/**
 * Constructor provides default values for properties
 */
var Adventure = function(){
  // (bool) is adventure from a stub?
  this.is_stub = false;

  // (bool) adventure stub's filename
  this.filename = false;

  // (bool) - index if pulled from stubs array
  this.index = false;

  // adventure title
  this.title = '';

  // adventure description
  this.desc = '';

  // (array of strings) tags for this adventure. can be used to get specific encounter types
  this.tags = [];

  // (array of effects) executed when adventure is complete
  this.success = [];

  // (array of encounters)
  this.encounters = [];

  //adventure actions
  this.actions = [];
};

/**
 * Prototype of object contains default methods for all Adventure objects
 */
Adventure.prototype = {
  // generic afterLoad method
  afterLoad: function( Game ) {}
};

/**
 * Object factor produces a new object, merges stub information, and does preprocessing
 */
Adventure.create = function( stub ){
  var adventure = new Adventure();

  if ( typeof stub === 'object' ) {

    // if the stub is from a file, reload it
    if ( stub.is_stub && stub.filename ) {
      console.log('-- adventure reloaded from file');

      // reload if adventure is a stub and not already loaded
      var fileStub = tools.files.getAdventure(stub.filename, stub.index);

      // merge argument stub and fileStub together
      // this let's us re-attach methods from the file
      // this stub was originally loaded from
      _.merge(fileStub, stub);

      // merge the resulting stub to this adventure
      _.merge(adventure, fileStub);
    }
    else {
      console.log("*** adventure loaded from non-file stub... this probably shouldn't happen");

      _.merge(adventure, stub);
    }
  }

  // add tags array if missing, and attach tag methods
  tools.initTags( adventure );

  return adventure;
};


module.exports = Adventure;