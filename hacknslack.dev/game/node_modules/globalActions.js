var tools = require('tools');

// init
var globalActions = {

  // create the action text and comment here for all global actions
  actions: {
    status: {
      cmd: "status",
      text: "Check your status",
      silent: true
    },
    help: {
      cmd: "help",
      text: "Get some game help",
      silent: true
    },
    attack: {
      cmd: "attack",
      text: "Attack that bitch!"
    },
    item: {
      cmd: "item",
      text: "Use an item by index"
    },
    equip: {
      cmd: "equip",
      text: "Equip an item in your inventory"
    },
    sit: {
      cmd: "sit",
      text: "Why don't you take a break"
    },
    spell: {
      cmd: "spell",
      text: "Cast a spell by index"
    },
    poop: {
      cmd: "poop",
      text: "Take a big dump"
    }
  },

  /**
   * Status
   *
   * @param Game
   * @param done
   */
  status: function( Game, done ){
    var p = Game.player;
    var c = Game.character;
    //var e = Game.encounter;

    console.log('--------------character class -------------------');
    console.log(c.class);

    Game.output( c.name );
    Game.output( 'Class: ' + c.class.name );
    Game.output( 'XP: ' + c.xp );
    Game.output( 'HP: ' + c.hp + ' / ' + c.attributes.hp );
    Game.output( 'Body: ' + c.attributes.body + ' + ' + c.getAttrBuff('body') );
    Game.output( 'Mind: ' + c.attributes.mind + ' + ' + c.getAttrBuff('mind') );
    Game.output( 'Spirit: ' + c.attributes.spirit + ' + ' + c.getAttrBuff('spirit') );

    Game.output( 'Current Adventure: ' + Game.adventure.title );
    Game.output( 'Current Encounter: ' + Game.encounter.title );

    // equipment
    Game.output('Equipment');
    Object.keys(c.equipment).forEach(function( key ){
      if ( c.equipment[ key].length ) {
        Game.output( key + ': ' + c.equipment[ key ] );
      }
    });

    // items
    Game.output('Inventory');
    if ( c.items ) {
      for (var i = 0; i < c.items.length; i++) {
        Game.output('- ' + i + ' : ' + c.items[i].name );
      }
    }

    done();
  },

  /**
   * Provide help info for the player
   *
   * @param Game
   * @param done
   */
  help: function( Game, done ){

    Game.output('here is some helpful info');

    done();
  },

  /**
   * Attack
   *
   * @param Game
   * @param done
   */
  attack: function( Game, done ){
    //console.log("that's an attack!");
    //console.log(Game);

    // get the challenge from the encounter
    var challenge = Game.encounter.challenge;
    // get the pc's attribute that applies to this encounter
    var stat = Game.character.getAttrTotal( challenge.attribute );
    // roll dice for the pc
    var roll = tools.random(1, stat);

    //console.log("rolled a " + roll);

    //if (challenge.attribute == "body") {
    //  Game.output("You pushy your body to its limits!");
    //} else if (challenge.attribute == "mind") {
    //  Game.output("You scrunch up your eyes and strain your brain!");
    //} else if (challenge.attribute == "spirit") {
    //  Game.output("You pour your soul into it!");
    //}
    
    // see if the player's roll is bigger than the challenge rating
    if ( roll >= challenge.rating ){
      // you win
      // loop through and execute each effect
      if ( Game.encounter.success ) {
        for ( var i = 0; i < Game.encounter.success.length; i++ ){
          var effect = Game.encounter.success[ i ];
          Game.doEffect( effect );
        }
      }
    }
    else {
      // loser
      // loop through and execute each effect
      if ( Game.encounter.fail ) {
        for (var i = 0; i < Game.encounter.fail.length; i++) {
          var effect = Game.encounter.fail[ i ];
          Game.doEffect( effect );
        }
      }
    }

    // go to next encounter
    Game.nextEncounter();

    done();
  },

  /**
   * Use an item generically
   *
   * @param Game
   * @param done
   */
  item: function( Game, done ){
    Game.output("use that item bro");
    var index = Game.input.target;

    if ( Game.character.items[ index ] && Game.character.items[ index ].effects ){
      var item = Game.character.items [ index ];
      for ( var i = 0; i < item.effects.length; i++ ){
        Game.doEffect( item.effects[ i ]);
      }

      // remove item from list
      Game.character.items.splice( index, 1 );
    }

    done();
  },

  equip: function( Game, done ){
    Game.output("equip that item bro");

    done();
  },

  sit: function( Game, done ){
    Game.output("sit down fool");

    done();
  },

  spell: function( Game, done ){
    Game.output("we could totally do something cool here");

    done();
  }
}

// adding new action

globalActions.poop = function( Game, done ){
  Game.output("huuunnnn  -- emit defensive - ah - fluids.");

  done();
}




module.exports = globalActions;